#!/usr/bin/env bash

<<comment
The idea with this script is to have everything I want to manage at one place to make my life easier. Remember this is meant to work for me it is not supposed to work for everyone else.

We are going to use jq and dialog to make it work. This packages will be installed. 
Copyright (c) xsoder 2025 

comment

set -euo pipefail

IFS=$'\n\t'

WIDTH=80
HEIGHT=40
CONFIG_DIR="$HOME/.config"
DOTFILES_DIR="$HOME/evenv"
PACKAGE_MANAGER="paru"
PACKAGES_JSON="$DOTFILES_DIR/packages.json"
SUDO_PASS=""
TMP_OUTPUT="/tmp/package-install-output.log"
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Source all module files
source "$SCRIPT_DIR/modules/dependencies"
source "$SCRIPT_DIR/modules/package_manager"
source "$SCRIPT_DIR/modules/package_tracking"
source "$SCRIPT_DIR/modules/dotfiles"
source "$SCRIPT_DIR/modules/setup"
source "$SCRIPT_DIR/modules/menu"
source "$SCRIPT_DIR/modules/utils"

main() {
    trap 'cleanup' INT TERM
    
    # Install essential dependencies first
    install_dialog
    install_jq
    
    dialog_box
    clear
    exit 0
}

cleanup() {
    clear
    printf "Script interrupted or terminated\n" >&2
    exit 1
}

main
